<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <!-- 
 	명령을 전달하기 위한 파일 
 	namespace : 영역을 부르는 별칭
 	parameterType : 이 명령을 실행하기 위해 필요한 데이터의 형태
 	resultType : 기대되는 결과물의 형태 (목록이든 아니든 dto 형태로 표기)
 	
 	부등호(<,>,=)를 쓰고 싶다면 
 	<![CDATA[
 	이곳에 명령어를 넣는다
 	]]> 
	
	형태에 따라 파라미터를 다르게 설정할 수 있다
	- #은 형태를 추론해 자동으로 따옴표 설정 및 인코딩 처리를 수행
	- $는 값을 있는 그대로 출력하는 명령이므로 주로 "항목"에 사용
		-$의 경우 SQL Injection 이라는 해킹 공격에 매우 취약하므로 사용에 주의
 -->
 
 <mapper namespace="admin"> <!-- 이건 꼭 있어야한다 -->
 	<!-- 로그인을 위한 아이디 불러오기 -->
 	<select id="getId" parameterType="adminDto" resultType="adminDto">
 		select * from admin where admin_id = #{admin_id}
 	</select>
 	
 	<!-- 관리자 가입시키기 -->
	<insert id="insert" parameterType="adminDto">
		insert into admin() values(
							admin_seq.nextval, 
							#{admin_id},
							#{admin_pw},
							#{admin_name},
							#{admin_email},
							'일반관리자',
							to_date(sysdate, 'yyyy-mm-dd hh24:mi:ss' ),
							to_date(sysdate, 'yyyy-mm-dd hh24:mi:ss' )
							)
	</insert>
	
	<!-- 최종로그인 일시 변동 -->
	<update id="lastLogin" parameterType="adminDto">
		update admin set admin_last_login = sysdate
	</update>
	
	<!-- 관리자 리스트 뽑아오기 -->
	<select id="getList" resultType="adminDto">
<!-- 		select * from admin where admin_grade = '일반관리자' -->
		select * from(
			select rownum rn, A.* from(
				select * from admin where admin_grade = '일반관리자' order by admin_no desc
			)A
		)where rn between #{startList} and #{listSize}
	</select>
	
	<select id="getBoardListCnt" resultType="int">
		select 
			count(*) 
		from 
			admin
	</select>
		
	<!-- 총 관리자 갯수 출력 -->
	<select id="countBoard" resultType="int">
		select count(*) from admin where admin_grade ='일반관리자'
	</select>	
		
	<select id="selectBoard" parameterType="paging" resultType="adminDto">
			select * from(
			select rownum rn, A.* from(
				select * from admin where admin_grade = '일반관리자' order by admin_no desc
			)A
		)where rn between #{start} and #{finish}
	</select>	
	
	<!-- 관리자 삭제 -->
	<delete id="delete" parameterType="adminDto">
		delete admin where admin_no = #{admin_no}
	</delete>
	
	<!-- 판매자 리스트 불러오기 -->
	<select id="sellerGetList" parameterType="paging" resultType="sellerDto">
		select * from(
			select rownum rn, A.* from(
				select * from seller order by seller_no desc
			)A
		)where rn between #{start} and #{finish}
	</select>
	
	<!-- 판매자 목록 총 갯수 가져오기 -->
	<select id="sellerCount" resultType="int">
		select count(*) from seller 
	</select>	
 </mapper> 

 