<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="order">
	<select id="getCartInfo" parameterType="String" resultType="cartInfoDto">
		select * from cart_info where partner_order_id = #{partner_order_id}
	</select>
	
	<select id="getCartInfoGoods" parameterType="int" resultType="cartInfoGoodsDto">
		select * from cart_info_goods where cart_info_no = #{cart_info_no}
	</select>
	
	<select id="getCartInfoOp" parameterType="int" resultType="cartInfoOpDto">
		select * from cart_info_op where cart_info_goods_no = #{cart_info_goods_no}
	</select>
	
	<!-- 회원 상품별 주문내역 정보 모두 가져오기 -->
	<select id="getCartInfoVO" parameterType="int" resultType="cartInfoVO">
 		select a.goods_no, a.goods_name,
 					b.cart_info_goods_no, b.cart_info_goods_price, b.cart_info_goods_quantity,
 					c.* from
			    goods A inner join cart_info_goods B on A.goods_no = B.goods_no
			    			inner join cart_info C on B.cart_info_no=C.cart_info_no
		    where C.member_no=#{member_no}
 	</select>
 	<!-- 상품별 구매확정 테이블 -->
	<select id="getOkList" parameterType="int" resultType="cartOkDto">
		select cart_ok.* from
		    cart_ok inner join cart_info_goods
		        on cart_ok.cart_info_goods_no = cart_info_goods.cart_info_goods_no
			where cart_ok.member_no=#{member_no}
	</select>
	
	<!-- 카테고리번호를 통한 최근 한달 이내, 판매량 Top5 판매자 -->
	<select id="getTopSales" parameterType="int" resultType="CartInfoVO">
		select *from(
			select rownum rn, RN.*from(
				select A.seller_no, sum(cart_info_goods.cart_info_goods_price), A.seller_id from
				    seller_category inner join seller A on seller_category.seller_no = A.seller_no
				            inner join goods on A.seller_no=goods.seller_no
				            inner join cart_info_goods on goods.goods_no = cart_info_goods.goods_no
				    where seller_category.category_no = #{category_no}
				group by A.seller_no, A.seller_id
				order by sum(cart_info_goods.cart_info_goods_price) desc
			)RN
		)where rn between 1 and 5 and sysdate >= sysdate-30
	</select>
</mapper>